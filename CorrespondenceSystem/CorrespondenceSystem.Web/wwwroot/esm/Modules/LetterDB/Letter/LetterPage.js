import{a as w,b as G,d as N}from"../../../_chunks/chunk-SHKIMZOM.js";import{a as P,b,d as U}from"../../../_chunks/chunk-W2A6TYLC.js";import{a as q}from"../../../_chunks/chunk-EAAQUTWP.js";import{c as i,f as n,g as m,i as s}from"../../../_chunks/chunk-THKE7DQS.js";var F=n(s(),1);var I=n(s(),1);var H=n(s(),1),D=(t=>(t[t.Draft=0]="Draft",t[t.Posted=1]="Posted",t[t.Received=2]="Received",t))(D||{});H.Decorators.registerEnumType(D,"CorrespondenceSystem.Modules.Enums.Letter.States","State");var T=class T extends I.ColumnsBase{};i(T,"LetterColumns"),T.columnsKey="LetterDB.Letter",T.Fields=(0,I.fieldsProxy)();var h=T;var O=n(s(),1),K=n(q(),1);var d=class extends K.GridEditorBase{getColumnsKey(){return w.columnsKey}getDialogType(){return N}getLocalTextPrefix(){return G.localTextPrefix}};i(d,"LetterAttachmentEditor"),d=m([O.Decorators.registerEditor("CorrespondenceSystem.LetterAttachmentDB.LetterAttachmentEditor")],d);var u=n(s(),1),V=n(q(),1);var p=class extends V.GridEditorBase{getColumnsKey(){return P.columnsKey}getDialogType(){return U}getLocalTextPrefix(){return b.localTextPrefix}AddSign(){(0,u.serviceCall)({url:(0,u.resolveUrl)("~/Services/SignLettersDB/SignLetters/AddSignLetter"),onSuccess:a=>{var e=this.view.getItems();let t={SignTitle:a.Title,SignId:a.Id,CreatedDate:a.CreatedDate};var S=this.id(t);S==null&&(t[this.getIdProperty()]=this.getNextId()),e.push(t),this.setEntities(e)},method:"post"})}getButtons(){var a=super.getButtons(),e=(0,u.tryFirst)(a,t=>t.cssClass=="add-button");if(e){let t=!0;e.onClick=S=>{t&&(this.AddSign(),t=!1,e.disabled=!0)}}return a}};i(p,"SignLettersEditor"),p=m([u.Decorators.registerEditor("CorrespondenceSystem.SignLettersDB.SignLettersEditor")],p);var o=n(s(),1);var k=n(s(),1),B=(e=>(e[e.Normal=0]="Normal",e[e.Secret=1]="Secret",e))(B||{});k.Decorators.registerEnumType(B,"CorrespondenceSystem.Modules.Enums.Letter.ConfidentialLevels","ConfidentialLevels");var J=n(s(),1),C=(e=>(e[e.Outgoing=0]="Outgoing",e[e.Incoming=1]="Incoming",e))(C||{});J.Decorators.registerEnumType(C,"CorrespondenceSystem.Modules.Enums.Letter.LetterTypes","LetterTypes");var Q=n(s(),1),A=(t=>(t[t.Urgent=0]="Urgent",t[t.Instant=1]="Instant",t[t.Normal=2]="Normal",t))(A||{});Q.Decorators.registerEnumType(A,"CorrespondenceSystem.Modules.Enums.Letter.PriorityStates","PriorityState");var g=class g extends o.PrefixedContext{constructor(a){if(super(a),!g.init){g.init=!0;var e=o.RadioButtonEditor,t=o.StringEditor,S=o.EnumEditor,y=o.ServiceLookupEditor,R=o.BooleanEditor,z=o.LookupEditor,W=o.TextAreaEditor,Y=d,Z=p;(0,o.initFormType)(g,["LetterType",e,"Title",t,"LetterIdentifier",t,"LetterIdentifierGen",t,"LetterNo",t,"PriorityState",e,"ConfidentialLevel",e,"State",S,"SenderId",y,"ReceiverId",y,"GrandSubjectId",y,"UseDefaultTemplate",R,"TemplateId",z,"LetterContent",W,"Tag",t,"LetterCarrier",t,"HasAttachment",R,"NeedAnswer",R,"DetailList",Y,"SignLettersDetailList",Z])}}};i(g,"LetterForm"),g.formKey="LetterDB.Letter";var x=g;var M=n(s(),1);var l=class l{};i(l,"LetterRow"),l.idProperty="Id",l.nameProperty="LetterIdentifier",l.localTextPrefix="LetterDB.Letter",l.deletePermission="Administration:General",l.insertPermission="Administration:General",l.readPermission="Administration:General",l.updatePermission="Administration:General",l.Fields=(0,M.fieldsProxy)();var L=l;var X=n(s(),1),v;(e=>(e.baseUrl="LetterDB/Letter",e.Methods={Create:"LetterDB/Letter/Create",Update:"LetterDB/Letter/Update",Delete:"LetterDB/Letter/Delete",Retrieve:"LetterDB/Letter/Retrieve",List:"LetterDB/Letter/List",SetDefaultRecriverSender:"LetterDB/Letter/SetDefaultRecriverSender",SetDefaultTemplate:"LetterDB/Letter/SetDefaultTemplate"},["Create","Update","Delete","Retrieve","List","SetDefaultRecriverSender","SetDefaultTemplate"].forEach(t=>{e[t]=function(S,y,R){return(0,X.serviceRequest)(e.baseUrl+"/"+t,S,y,R)}})))(v||(v={}));var E=n(s(),1);var r=n(s(),1);var c=class extends r.EntityDialog{constructor(){super(...arguments);this.form=new x(this.idPrefix)}getFormKey(){return x.formKey}getRowDefinition(){return L}getService(){return v.baseUrl}afterLoadEntity(){this.SetRecriverSender(),this.form.LetterType.changeSelect2(e=>{this.form.LetterType.value===0 .toString()&&r.EditorUtils.setValue(this.form.State,0)}),this.form.LetterType.changeSelect2(e=>{this.SetDefaultTemplate()})}validateBeforeSave(){return this.form.HasAttachment.value&&this.form.DetailList.value.length==0?((0,r.notifyError)("Attach file!!!"),!1):!0}SetRecriverSender(){(0,r.serviceCall)({url:(0,r.resolveUrl)("~/Services/LetterDB/Letter/SetDefaultRecriverSender"),onSuccess:e=>{e?this.form.LetterType.changeSelect2(t=>{if(this.form.LetterType.value==1 .toString()&&(r.EditorUtils.setValue(this.form.ReceiverId,e),r.EditorUtils.setReadonly(this.form.ReceiverId.element,!0),r.EditorUtils.setValue(this.form.SenderId,null),r.EditorUtils.setReadonly(this.form.SenderId.element,!1)),this.form.LetterType.value==0 .toString()){var S=this.SetRecriverSender();r.EditorUtils.setValue(this.form.SenderId,e),r.EditorUtils.setReadonly(this.form.SenderId.element,!0),r.EditorUtils.setValue(this.form.ReceiverId,null),r.EditorUtils.setReadonly(this.form.ReceiverId.element,!1)}}):console.error("Invalid response format for SetDefaultRecriverSender")},method:"post"})}SetDefaultTemplate(){(0,r.serviceCall)({url:(0,r.resolveUrl)("~/Services/LetterDB/Letter/SetDefaultTemplate"),onSuccess:e=>{this.form.LetterType.value===0 .toString()?(r.EditorUtils.setValue(this.form.UseDefaultTemplate,!0),r.EditorUtils.setValue(this.form.TemplateId,e),r.EditorUtils.setReadonly(this.form.TemplateId.element,!0)):(r.EditorUtils.setValue(this.form.UseDefaultTemplate,!1),r.EditorUtils.setValue(this.form.TemplateId,null),r.EditorUtils.setReadonly(this.form.TemplateId.element,!1))},method:"post"})}};i(c,"LetterDialog"),c=m([r.Decorators.registerClass("CorrespondenceSystem.LetterDB.LetterDialog")],c);var f=class extends E.EntityGrid{getColumnsKey(){return h.columnsKey}getDialogType(){return c}getRowDefinition(){return L}getService(){return v.baseUrl}constructor(a){super(a)}};i(f,"LetterGrid"),f=m([E.Decorators.registerClass("CorrespondenceSystem.LetterDB.LetterGrid")],f);function _(){(0,F.initFullHeightGridPage)(new f($("#GridDiv")).element)}i(_,"pageInit");export{_ as default};
//# sourceMappingURL=LetterPage.js.map
