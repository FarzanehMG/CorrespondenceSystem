import{a as J,b as k,d as j}from"../../../_chunks/chunk-5LVMS7OQ.js";import{a as N,b as V,d as Q}from"../../../_chunks/chunk-3QJHLSMQ.js";import{a as q,b as F,d as O}from"../../../_chunks/chunk-ABATKAFT.js";import{a as U,b as H,d as K}from"../../../_chunks/chunk-G3IAK34I.js";import{a as b}from"../../../_chunks/chunk-EAAQUTWP.js";import{c as o,f as n,g as d,i as l}from"../../../_chunks/chunk-THKE7DQS.js";var se=n(l(),1);var B=n(l(),1);var M=n(l(),1),C=(r=>(r[r.Draft=0]="Draft",r[r.Posted=1]="Posted",r[r.Received=2]="Received",r))(C||{});M.Decorators.registerEnumType(C,"CorrespondenceSystem.Modules.Enums.Letter.States","State");var x=class x extends B.ColumnsBase{};o(x,"LetterColumns"),x.columnsKey="LetterDB.Letter",x.Fields=(0,B.fieldsProxy)();var P=x;var T=n(l(),1),X=n(b(),1);var p=class extends X.GridEditorBase{getColumnsKey(){return N.columnsKey}getDialogType(){return Q}getLocalTextPrefix(){return V.localTextPrefix}validateEntity(i,t){i.Id=(0,T.toId)(i.Id);var r=this.view.getItems().find(a=>a.Id===i.Id);return r&&this.id(r)!==t?((0,T.alertDialog)("This product is already in order details!"),!1):(t!=null||(t=i[this.getIdProperty()]),!0)}};o(p,"TaskDescriptionEditor"),p=d([T.Decorators.registerEditor("CorrespondenceSystem.CounterpartDB.CounterpartEditor")],p);var W=n(l(),1),z=n(b(),1);var c=class extends z.GridEditorBase{getColumnsKey(){return J.columnsKey}getDialogType(){return j}getLocalTextPrefix(){return k.localTextPrefix}};o(c,"LetterAttachmentEditor"),c=d([W.Decorators.registerEditor("CorrespondenceSystem.LetterAttachmentDB.LetterAttachmentEditor")],c);var Y=n(l(),1),Z=n(b(),1);var g=class extends Z.GridEditorBase{getColumnsKey(){return U.columnsKey}getDialogType(){return K}getLocalTextPrefix(){return H.localTextPrefix}};o(g,"RelatedLettersEditor"),g=d([Y.Decorators.registerEditor("CorrespondenceSystem.RelatedLettersDB.RelatedLettersEditor")],g);var h=n(l(),1),_=n(b(),1);var L=class extends _.GridEditorBase{getColumnsKey(){return q.columnsKey}getDialogType(){return O}getLocalTextPrefix(){return F.localTextPrefix}AddSign(){(0,h.serviceCall)({url:(0,h.resolveUrl)("~/Services/SignLettersDB/SignLetters/AddSignLetter"),onSuccess:i=>{var t=this.view.getItems();let r={SignTitle:i.Title,SignId:i.Id,CreatedDate:i.CreatedDate};var a=this.id(r);a==null&&(r[this.getIdProperty()]=this.getNextId()),t.push(r),this.setEntities(t)},method:"post"})}getButtons(){var i=super.getButtons(),t=(0,h.tryFirst)(i,r=>r.cssClass=="add-button");if(t){let r=!0;t.onClick=a=>{r&&(this.AddSign(),r=!1,t.disabled=!0)}}return i}};o(L,"SignLettersEditor"),L=d([h.Decorators.registerEditor("CorrespondenceSystem.SignLettersDB.SignLettersEditor")],L);var s=n(l(),1);var ee=n(l(),1),A=(t=>(t[t.Normal=0]="Normal",t[t.Secret=1]="Secret",t))(A||{});ee.Decorators.registerEnumType(A,"CorrespondenceSystem.Modules.Enums.Letter.ConfidentialLevels","ConfidentialLevels");var te=n(l(),1),G=(r=>(r[r.Outgoing=0]="Outgoing",r[r.Incoming=1]="Incoming",r[r.Proceedings=2]="Proceedings",r))(G||{});te.Decorators.registerEnumType(G,"CorrespondenceSystem.Modules.Enums.Letter.LetterTypes","LetterTypes");var re=n(l(),1),w=(r=>(r[r.Urgent=0]="Urgent",r[r.Instant=1]="Instant",r[r.Normal=2]="Normal",r))(w||{});re.Decorators.registerEnumType(w,"CorrespondenceSystem.Modules.Enums.Letter.PriorityStates","PriorityState");var D=class D extends s.PrefixedContext{constructor(i){if(super(i),!D.init){D.init=!0;var t=s.RadioButtonEditor,r=s.StringEditor,a=s.EnumEditor,f=s.ServiceLookupEditor,v=s.BooleanEditor,ae=s.LookupEditor,le=s.TextAreaEditor,de=c,me=L,ue=s.ImageUploadEditor,fe=p,pe=g;(0,s.initFormType)(D,["LetterType",t,"Title",r,"LetterIdentifier",r,"LetterIdentifierGen",r,"LetterNo",r,"PriorityState",t,"ConfidentialLevel",t,"State",a,"SenderId",f,"ReceiverId",f,"GrandSubjectId",f,"UseDefaultTemplate",v,"TemplateId",ae,"ListOfAttendees",r,"LetterContent",le,"Tag",r,"LetterCarrier",r,"HasAttachment",v,"NeedAnswer",v,"DetailList",de,"SignLettersDetailList",me,"LetterFile",ue,"CounterpartDetailList",fe,"RelatedLetterDetailList",pe])}}};o(D,"LetterForm"),D.formKey="LetterDB.Letter";var E=D;var ie=n(l(),1);var m=class m{};o(m,"LetterRow"),m.idProperty="Id",m.isActiveProperty="IsActive",m.nameProperty="LetterIdentifier",m.localTextPrefix="LetterDB.Letter",m.deletePermission="Administration:General",m.insertPermission="Administration:General",m.readPermission="Administration:General",m.updatePermission="Administration:General",m.Fields=(0,ie.fieldsProxy)();var S=m;var oe=n(l(),1),I;(t=>(t.baseUrl="LetterDB/Letter",t.Methods={Create:"LetterDB/Letter/Create",Update:"LetterDB/Letter/Update",Delete:"LetterDB/Letter/Delete",Retrieve:"LetterDB/Letter/Retrieve",List:"LetterDB/Letter/List",SetDefaultRecriverSender:"LetterDB/Letter/SetDefaultRecriverSender",SetDefaultTemplate:"LetterDB/Letter/SetDefaultTemplate",SetDefaultIdentifireGen:"LetterDB/Letter/SetDefaultIdentifireGen"},["Create","Update","Delete","Retrieve","List","SetDefaultRecriverSender","SetDefaultTemplate","SetDefaultIdentifireGen"].forEach(r=>{t[r]=function(a,f,v){return(0,oe.serviceRequest)(t.baseUrl+"/"+r,a,f,v)}})))(I||(I={}));var e=n(l(),1);var y=class extends e.EntityDialog{constructor(){super(...arguments);this.form=new E(this.idPrefix)}getFormKey(){return E.formKey}getRowDefinition(){return S}getService(){return I.baseUrl}executeReport(t,r){if(this.validateForm()){var a=new Object;this.propertyGrid.save(a),(0,e.postToService)({service:"Report/Execute",request:{ReportKey:this.reportKey,DesignId:"Default",ExportType:r,Parameters:a},target:t})}}getToolbarButtons(){var t=super.getToolbarButtons();return t.splice((0,e.indexOf)(t,r=>r.cssClass=="undo-delete-button"),1),t.splice((0,e.indexOf)(t,r=>r.cssClass=="localization-button"),1),t.splice((0,e.indexOf)(t,r=>r.cssClass=="clone-button"),1),t.splice((0,e.indexOf)(t,r=>r.cssClass=="apply-changes-button"),1),t}afterLoadEntity(){this.SetRecriverSender(),this.SetDefaultIdentifireGen(),this.form.LetterType.changeSelect2(t=>{this.form.LetterType.value===0 .toString()?e.EditorUtils.setValue(this.form.State,0):this.form.LetterType.value===2 .toString()&&e.EditorUtils.setReadonly(this.form.ListOfAttendees.element,!1)}),this.form.LetterType.changeSelect2(t=>{this.form.LetterType.value===0 .toString()?(e.EditorUtils.setRequired(this.form.SenderId,!0),e.EditorUtils.setRequired(this.form.ReceiverId,!0)):this.form.LetterType.value===1 .toString()?(e.EditorUtils.setRequired(this.form.SenderId,!0),e.EditorUtils.setRequired(this.form.ReceiverId,!0)):(e.EditorUtils.setRequired(this.form.SenderId,!1),e.EditorUtils.setRequired(this.form.ReceiverId,!1))}),this.form.LetterType.changeSelect2(t=>{this.SetDefaultTemplate()}),this.form.LetterType.changeSelect2(t=>{this.form.LetterType.value==2 .toString()?(e.EditorUtils.setReadonly(this.form.LetterIdentifier.element,!0),e.EditorUtils.setReadonly(this.form.LetterIdentifierGen.element,!0),e.EditorUtils.setReadonly(this.form.LetterNo.element,!0),e.EditorUtils.setReadonly(this.form.ReceiverId.element,!0),e.EditorUtils.setReadonly(this.form.SenderId.element,!0),e.EditorUtils.setReadonly(this.form.TemplateId.element,!0),e.EditorUtils.setReadonly(this.form.LetterContent.element,!0),e.EditorUtils.setReadonly(this.form.Tag.element,!0),e.EditorUtils.setReadonly(this.form.LetterCarrier.element,!0),e.EditorUtils.setReadonly(this.form.State.element,!0),e.EditorUtils.setReadonly(this.form.CounterpartDetailList.element,!0),this.HideCounterPart(),this.HideRelationLetter(),this.HideSignLetter()):(e.EditorUtils.setReadonly(this.form.LetterIdentifier.element,!1),e.EditorUtils.setReadonly(this.form.LetterIdentifierGen.element,!1),e.EditorUtils.setReadonly(this.form.LetterNo.element,!1),e.EditorUtils.setReadonly(this.form.ReceiverId.element,!1),e.EditorUtils.setReadonly(this.form.SenderId.element,!1),e.EditorUtils.setReadonly(this.form.TemplateId.element,!1),e.EditorUtils.setReadonly(this.form.LetterContent.element,!1),e.EditorUtils.setReadonly(this.form.Tag.element,!1),e.EditorUtils.setReadonly(this.form.LetterCarrier.element,!1),e.EditorUtils.setReadonly(this.form.State.element,!1),e.EditorUtils.setReadonly(this.form.CounterpartDetailList.element,!1))})}HideCounterPart(){this.form.LetterType.value==2 .toString()&&this.hideEditorTab(this.form.CounterpartDetailList.getGridField(),!0,!0),this.form.LetterType.changeSelect2(t=>{this.form.LetterType.value==2 .toString()?this.hideEditorTab(this.form.CounterpartDetailList.getGridField(),!0,!0):this.hideEditorTab(this.form.CounterpartDetailList.getGridField(),!0,!1)})}HideRelationLetter(){this.form.LetterType.value==2 .toString()&&this.hideEditorTab(this.form.RelatedLetterDetailList.getGridField(),!0,!0),this.form.LetterType.changeSelect2(t=>{this.form.LetterType.value==2 .toString()?this.hideEditorTab(this.form.RelatedLetterDetailList.getGridField(),!0,!0):this.hideEditorTab(this.form.RelatedLetterDetailList.getGridField(),!0,!1)})}HideSignLetter(){this.form.LetterType.value==2 .toString()&&this.hideEditorTab(this.form.SignLettersDetailList.getGridField(),!0,!0),this.form.LetterType.changeSelect2(t=>{this.form.LetterType.value==2 .toString()?this.hideEditorTab(this.form.SignLettersDetailList.getGridField(),!0,!0):this.hideEditorTab(this.form.SignLettersDetailList.getGridField(),!0,!1)})}validateBeforeSave(){return this.form.HasAttachment.value&&this.form.DetailList.value.length==0?((0,e.notifyError)("Attach file!!!"),!1):!0}SetRecriverSender(){(0,e.serviceCall)({url:(0,e.resolveUrl)("~/Services/LetterDB/Letter/SetDefaultRecriverSender"),onSuccess:t=>{t?this.form.LetterType.changeSelect2(r=>{if(this.form.LetterType.value==1 .toString()&&(e.EditorUtils.setValue(this.form.ReceiverId,t),e.EditorUtils.setReadonly(this.form.ReceiverId.element,!0),e.EditorUtils.setValue(this.form.SenderId,null),e.EditorUtils.setReadonly(this.form.SenderId.element,!1)),this.form.LetterType.value==0 .toString()){var a=this.SetRecriverSender();e.EditorUtils.setValue(this.form.SenderId,t),e.EditorUtils.setReadonly(this.form.SenderId.element,!0),e.EditorUtils.setValue(this.form.ReceiverId,null),e.EditorUtils.setReadonly(this.form.ReceiverId.element,!1)}}):console.error("Invalid response format for SetDefaultRecriverSender")},method:"post"})}SetDefaultTemplate(){(0,e.serviceCall)({url:(0,e.resolveUrl)("~/Services/LetterDB/Letter/SetDefaultTemplate"),onSuccess:t=>{this.form.LetterType.value===0 .toString()?(e.EditorUtils.setValue(this.form.UseDefaultTemplate,!0),e.EditorUtils.setValue(this.form.TemplateId,t),e.EditorUtils.setReadonly(this.form.TemplateId.element,!0)):this.form.LetterType.value===1 .toString()?(e.EditorUtils.setValue(this.form.UseDefaultTemplate,!0),e.EditorUtils.setValue(this.form.TemplateId,null),e.EditorUtils.setReadonly(this.form.TemplateId.element,!1)):e.EditorUtils.setReadonly(this.form.TemplateId.element,!0)},method:"post"})}SetDefaultIdentifireGen(){(0,e.serviceCall)({url:(0,e.resolveUrl)("~/Services/LetterDB/Letter/SetDefaultIdentifireGen"),onSuccess:t=>{t?this.form.LetterType.changeSelect2(r=>{if(this.form.LetterType.value==0 .toString()&&(e.EditorUtils.setValue(this.form.LetterIdentifierGen,t.Identifier),e.EditorUtils.setReadonly(this.form.LetterIdentifierGen.element,!0)),this.form.LetterType.value==1 .toString()){var a=this.SetRecriverSender();e.EditorUtils.setValue(this.form.LetterIdentifierGen,null),e.EditorUtils.setReadonly(this.form.LetterIdentifierGen.element,!1)}}):console.error("Invalid response format for SetDefaultRecriverSender")},method:"post"})}hideEditorTab(t,r=!0,a){if(a==!0){let f=t.closest(".tab-pane").hide().attr("id");t.closest(".s-PropertyGrid").find(`a[href='#${f}']`).closest("li").hide()}else{let f=t.closest(".tab-pane").hide().attr("id");t.closest(".s-PropertyGrid").find(`a[href='#${f}']`).closest("li").show(),t.closest(".tab-pane").removeAttr("style")}}};o(y,"LetterDialog"),y=d([e.Decorators.registerClass("CorrespondenceSystem.LetterDB.LetterDialog")],y);var u=n(l(),1);var R=class extends u.EntityGrid{getColumnsKey(){return P.columnsKey}getDialogType(){return y}getRowDefinition(){return S}getService(){return I.baseUrl}constructor(i){super(i)}getColumns(){var i=super.getColumns();let t={name:"\u062F\u0627\u0646\u0644\u0648\u062F \u0646\u0627\u0645\u0647",width:120,format:r=>'<a class="fa fa-download downloaded" style="display: flex; align-items: center; justify-content: center;"></a>',minWidth:120,maxWidth:120,cssClass:"download"};return i.push(t),i}onClick(i,t,r){super.onClick(i,t,r);let a=this.itemAt(t);$(i.target).hasClass("download")&&(i.preventDefault(),this.DownloadWord(a.Id))}DownloadWord(i){(0,u.serviceCall)({url:(0,u.resolveUrl)("~/Services/LetterDB/Letter/DownloadWordLetter"),data:JSON.stringify({Id:i}),contentType:"application/json",onSuccess:t=>t,method:"post"})}getQuickFilters(){let i=super.getQuickFilters(),t=(0,u.tryFirst)(i,r=>r.field==S.Fields.Tag);return t.handler=r=>{r.active&&(r.request.Criteria=u.Criteria.and(r.request.Criteria,[[S.Fields.Tag],"like","%"+r.value+"%"]))},i}};o(R,"LetterGrid"),R=d([u.Decorators.registerClass("CorrespondenceSystem.LetterDB.LetterGrid")],R);function ce(){(0,se.initFullHeightGridPage)(new R($("#GridDiv")).element)}o(ce,"pageInit");export{ce as default};
//# sourceMappingURL=LetterPage.js.map
