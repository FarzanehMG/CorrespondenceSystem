import{a as q,b as G,d as O}from"../../../_chunks/chunk-5LVMS7OQ.js";import{a as A,b as w,d as U}from"../../../_chunks/chunk-ABATKAFT.js";import{a as P}from"../../../_chunks/chunk-EAAQUTWP.js";import{c as s,f as n,g as m,i as a}from"../../../_chunks/chunk-THKE7DQS.js";var M=n(a(),1);var I=n(a(),1);var N=n(a(),1),h=(t=>(t[t.Draft=0]="Draft",t[t.Posted=1]="Posted",t[t.Received=2]="Received",t))(h||{});N.Decorators.registerEnumType(h,"CorrespondenceSystem.Modules.Enums.Letter.States","State");var x=class x extends I.ColumnsBase{};s(x,"LetterColumns"),x.columnsKey="LetterDB.Letter",x.Fields=(0,I.fieldsProxy)();var C=x;var K=n(a(),1),H=n(P(),1);var p=class extends H.GridEditorBase{getColumnsKey(){return q.columnsKey}getDialogType(){return O}getLocalTextPrefix(){return G.localTextPrefix}};s(p,"LetterAttachmentEditor"),p=m([K.Decorators.registerEditor("CorrespondenceSystem.LetterAttachmentDB.LetterAttachmentEditor")],p);var c=n(a(),1),k=n(P(),1);var u=class extends k.GridEditorBase{getColumnsKey(){return A.columnsKey}getDialogType(){return U}getLocalTextPrefix(){return w.localTextPrefix}AddSign(){(0,c.serviceCall)({url:(0,c.resolveUrl)("~/Services/SignLettersDB/SignLetters/AddSignLetter"),onSuccess:o=>{var e=this.view.getItems();let t={SignTitle:o.Title,SignId:o.Id,CreatedDate:o.CreatedDate};var l=this.id(t);l==null&&(t[this.getIdProperty()]=this.getNextId()),e.push(t),this.setEntities(e)},method:"post"})}getButtons(){var o=super.getButtons(),e=(0,c.tryFirst)(o,t=>t.cssClass=="add-button");if(e){let t=!0;e.onClick=l=>{t&&(this.AddSign(),t=!1,e.disabled=!0)}}return o}};s(u,"SignLettersEditor"),u=m([c.Decorators.registerEditor("CorrespondenceSystem.SignLettersDB.SignLettersEditor")],u);var i=n(a(),1);var F=n(a(),1),B=(e=>(e[e.Normal=0]="Normal",e[e.Secret=1]="Secret",e))(B||{});F.Decorators.registerEnumType(B,"CorrespondenceSystem.Modules.Enums.Letter.ConfidentialLevels","ConfidentialLevels");var J=n(a(),1),E=(e=>(e[e.Outgoing=0]="Outgoing",e[e.Incoming=1]="Incoming",e))(E||{});J.Decorators.registerEnumType(E,"CorrespondenceSystem.Modules.Enums.Letter.LetterTypes","LetterTypes");var j=n(a(),1),b=(t=>(t[t.Urgent=0]="Urgent",t[t.Instant=1]="Instant",t[t.Normal=2]="Normal",t))(b||{});j.Decorators.registerEnumType(b,"CorrespondenceSystem.Modules.Enums.Letter.PriorityStates","PriorityState");var L=class L extends i.PrefixedContext{constructor(o){if(super(o),!L.init){L.init=!0;var e=i.RadioButtonEditor,t=i.StringEditor,l=i.EnumEditor,R=i.ServiceLookupEditor,D=i.BooleanEditor,W=i.LookupEditor,z=i.TextAreaEditor,Y=p,Z=u,_=i.ImageUploadEditor;(0,i.initFormType)(L,["LetterType",e,"Title",t,"LetterIdentifier",t,"LetterIdentifierGen",t,"LetterNo",t,"PriorityState",e,"ConfidentialLevel",e,"State",l,"SenderId",R,"ReceiverId",R,"GrandSubjectId",R,"UseDefaultTemplate",D,"TemplateId",W,"LetterContent",z,"Tag",t,"LetterCarrier",t,"HasAttachment",D,"NeedAnswer",D,"DetailList",Y,"SignLettersDetailList",Z,"LetterFile",_])}}};s(L,"LetterForm"),L.formKey="LetterDB.Letter";var T=L;var Q=n(a(),1);var d=class d{};s(d,"LetterRow"),d.idProperty="Id",d.isActiveProperty="IsActive",d.nameProperty="LetterIdentifier",d.localTextPrefix="LetterDB.Letter",d.deletePermission="Administration:General",d.insertPermission="Administration:General",d.readPermission="Administration:General",d.updatePermission="Administration:General",d.Fields=(0,Q.fieldsProxy)();var v=d;var V=n(a(),1),y;(e=>(e.baseUrl="LetterDB/Letter",e.Methods={Create:"LetterDB/Letter/Create",Update:"LetterDB/Letter/Update",Delete:"LetterDB/Letter/Delete",Retrieve:"LetterDB/Letter/Retrieve",List:"LetterDB/Letter/List",SetDefaultRecriverSender:"LetterDB/Letter/SetDefaultRecriverSender",SetDefaultTemplate:"LetterDB/Letter/SetDefaultTemplate"},["Create","Update","Delete","Retrieve","List","SetDefaultRecriverSender","SetDefaultTemplate"].forEach(t=>{e[t]=function(l,R,D){return(0,V.serviceRequest)(e.baseUrl+"/"+t,l,R,D)}})))(y||(y={}));var S=n(a(),1);var r=n(a(),1);var f=class extends r.EntityDialog{constructor(){super(...arguments);this.form=new T(this.idPrefix)}getFormKey(){return T.formKey}getRowDefinition(){return v}getService(){return y.baseUrl}executeReport(e,t){if(this.validateForm()){var l=new Object;this.propertyGrid.save(l),(0,r.postToService)({service:"Report/Execute",request:{ReportKey:this.reportKey,DesignId:"Default",ExportType:t,Parameters:l},target:e})}}getToolbarButtons(){var e=super.getToolbarButtons();return e.splice((0,r.indexOf)(e,t=>t.cssClass=="undo-delete-button"),1),e.splice((0,r.indexOf)(e,t=>t.cssClass=="localization-button"),1),e.splice((0,r.indexOf)(e,t=>t.cssClass=="clone-button"),1),e.splice((0,r.indexOf)(e,t=>t.cssClass=="apply-changes-button"),1),e}afterLoadEntity(){this.SetRecriverSender(),this.form.LetterType.changeSelect2(e=>{this.form.LetterType.value===0 .toString()&&r.EditorUtils.setValue(this.form.State,0)}),this.form.LetterType.changeSelect2(e=>{this.SetDefaultTemplate()})}validateBeforeSave(){return this.form.HasAttachment.value&&this.form.DetailList.value.length==0?((0,r.notifyError)("Attach file!!!"),!1):!0}SetRecriverSender(){(0,r.serviceCall)({url:(0,r.resolveUrl)("~/Services/LetterDB/Letter/SetDefaultRecriverSender"),onSuccess:e=>{e?this.form.LetterType.changeSelect2(t=>{if(this.form.LetterType.value==1 .toString()&&(r.EditorUtils.setValue(this.form.ReceiverId,e),r.EditorUtils.setReadonly(this.form.ReceiverId.element,!0),r.EditorUtils.setValue(this.form.SenderId,null),r.EditorUtils.setReadonly(this.form.SenderId.element,!1)),this.form.LetterType.value==0 .toString()){var l=this.SetRecriverSender();r.EditorUtils.setValue(this.form.SenderId,e),r.EditorUtils.setReadonly(this.form.SenderId.element,!0),r.EditorUtils.setValue(this.form.ReceiverId,null),r.EditorUtils.setReadonly(this.form.ReceiverId.element,!1)}}):console.error("Invalid response format for SetDefaultRecriverSender")},method:"post"})}SetDefaultTemplate(){(0,r.serviceCall)({url:(0,r.resolveUrl)("~/Services/LetterDB/Letter/SetDefaultTemplate"),onSuccess:e=>{this.form.LetterType.value===0 .toString()?(r.EditorUtils.setValue(this.form.UseDefaultTemplate,!0),r.EditorUtils.setValue(this.form.TemplateId,e),r.EditorUtils.setReadonly(this.form.TemplateId.element,!0)):(r.EditorUtils.setValue(this.form.UseDefaultTemplate,!1),r.EditorUtils.setValue(this.form.TemplateId,null),r.EditorUtils.setReadonly(this.form.TemplateId.element,!1))},method:"post"})}};s(f,"LetterDialog"),f=m([r.Decorators.registerClass("CorrespondenceSystem.LetterDB.LetterDialog")],f);var g=class extends S.EntityGrid{getColumnsKey(){return C.columnsKey}getDialogType(){return f}getRowDefinition(){return v}getService(){return y.baseUrl}constructor(o){super(o)}getColumns(){var o=super.getColumns();let e={name:"Download letter",width:120,format:t=>'<a class="fa fa-download downloaded" style="display: flex; align-items: center; justify-content: center;"></a>',minWidth:120,maxWidth:120,cssClass:"download"};return o.push(e),o}onClick(o,e,t){super.onClick(o,e,t);let l=this.itemAt(e);$(o.target).hasClass("download")&&(o.preventDefault(),this.DownloadWord(l.Id))}DownloadWord(o){(0,S.serviceCall)({url:(0,S.resolveUrl)("~/Services/LetterDB/Letter/DownloadWordLetter"),data:JSON.stringify({Id:o}),contentType:"application/json",onSuccess:e=>e,method:"post"})}};s(g,"LetterGrid"),g=m([S.Decorators.registerClass("CorrespondenceSystem.LetterDB.LetterGrid")],g);function ee(){(0,M.initFullHeightGridPage)(new g($("#GridDiv")).element)}s(ee,"pageInit");export{ee as default};
//# sourceMappingURL=LetterPage.js.map
